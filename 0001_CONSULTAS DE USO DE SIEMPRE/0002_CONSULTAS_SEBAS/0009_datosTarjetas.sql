select CT.INUMEROTARJETA,
       t1.DSALDO                                                                       SALDOMONEDERO,
       XX.SALDO                                                                        SALDOTARJETA,
       M.ICONTADORRECARGA                                                              LTCMONEDERO,
       XX.loadtranscounter2                                                            LTCTRANSACCIONES,
       M.ICONTADORRECARGAAPLICADA                                                      LTCCAMBIOSMONEDERO,
       T1.DTFECHAULTIMOABONO                                                        AS "ULTIMA RECARGA",
       T1.DTFECHAULTIMAOPERACION                                                    AS "ULTIMA DEBITACION",
       CASE WHEN APT.SNUMEROTARJETA is null THEN 'SIN APP' ELSE 'VINCULADO APP' END AS "USUARIO ASIGNADO APP"
from CREDENCIALIZACION.TARJETAS CT
         LEFT JOIN MONEDEROCONSULTAS.ESTADODECUENTA t1 ON T1.INUMTARJETA = CT.INUMEROTARJETA
         LEFT JOIN (select inumerotarjeta
                         , MAX(DTFECHAOPERACION) KEEP (DENSE_RANK LAST ORDER BY DTFECHAOPERACION) AS DTFECHAOPERACION
                         , MAX(DSALDO) KEEP (DENSE_RANK LAST ORDER BY DTFECHAOPERACION)           AS SALDO
                         , MAX(IERROR) KEEP (DENSE_RANK LAST ORDER BY DTFECHAOPERACION)           AS IERROR
                         , MAX(loadtranscounter)                                                  AS loadtranscounter2
                    FROM SINCRONIZADOR.DETALLESINCRONIZACIONTRANSACCIONESNFC
                    WHERE 1 = 1
                      AND SINCIDENCIA not like 'DEB. PEND.%'-->CORRECCION A NIVEL DATOS PORQUE NO DEBE TOMAR LOS REPROCESOS QUE HAYAMOS HECHO
                      AND SINCIDENCIA not like 'SIM. DEB. PEND.%'-->CONDICION PARA EVITAR AGARRAR LOS QUE SEAN REPROCESOS
                    GROUP BY inumerotarjeta) XX on xx.INUMEROTARJETA = CT.INUMEROTARJETA
         LEFT JOIN SINCRONIZADOR.MONEDERO M on M.UIDMONEDERO = CT.UIDMONEDERO
         LEFT JOIN APPMONEDEROCOMMAND.TARJETAUSUARIO APT
                   on APT.SNUMEROTARJETA = CT.INUMEROTARJETA and APT.bactivo = 1 AND APT.bbaja = 0
WHERE CT.INUMEROTARJETA IN (
                            5000000000314831,
5000000000401563,
5000000000224903,
5000000000168974,
5000000000432425,
5000000000630874,
5000000000365504,
5000000000394329,
5000000000395097,
5000000000355234,
5000000000383238,
5000000000337409,
5000000000140237,
5000000000301128,
5000000000898050,
5000000000721166,
5000000000384010,
5000000000202606,
5000000000979558,
5000000000348306,
5000000000307434,
5000000000356647,
5000000000388596,
5000000000672202,
5000000000979838,
5000000000943981,
5000000000939666,
5000000000388905,
5000000000332310,
5000000000135166,
5000000000977852,
5000000000587711,
5000000000389772,
5000000000950153,
5000000000240182,
5000000000585734,
5000000000915865,
5000000000148046,
5000000000889580,
5000000000109569
    )
