-- ACTUALIZAR DIFERENCIA DE SALDO (MONEDEROCONSULTAS vs APPMONEDEROCOMMAND)
MERGE INTO APPMONEDEROCOMMAND.ESTADODECUENTA dest
USING (
SELECT t1.UIDMONEDERO, t1.DSALDO
FROM MONEDEROCONSULTAS.ESTADODECUENTA t1
INNER JOIN APPMONEDEROCOMMAND.ESTADODECUENTA t2 ON t1.UIDMONEDERO = t2.UIDMONEDERO
WHERE t1.BACTIVO = 1 AND t1.BBAJA = 0 AND (t1.DSALDO <> t2.DSALDO)
) src
ON (dest.UIDMONEDERO = src.UIDMONEDERO)
WHEN MATCHED THEN
UPDATE SET dest.DSALDO = src.DSALDO;


SELECT 'MONEDEROS diferencia en campo DSALDO (MONEDEROCONSULTAS vs APPMONEDEROCOMMAND)' AS fuente,
COUNT(0) AS discrepancias
FROM MONEDEROCONSULTAS.ESTADODECUENTA t1
INNER JOIN APPMONEDEROCOMMAND.ESTADODECUENTA t2 ON t1.UIDMONEDERO = t2.UIDMONEDERO
WHERE t1.BACTIVO = 1 AND t1.BBAJA = 0 AND (t1.DSALDO <> t2.DSALDO);



-- ACTUALIZAR DIFERENCIA DE SALDO (MONEDEROCONSULTAS vs APPMONEDEROQUERY)
MERGE INTO APPMONEDEROQUERY.ESTADODECUENTA dest
USING (
SELECT t1.UIDMONEDERO,t1.DSALDO
FROM MONEDEROCONSULTAS.ESTADODECUENTA t1
INNER JOIN APPMONEDEROQUERY.ESTADODECUENTA t2 ON t1.UIDMONEDERO = t2.UIDMONEDERO
WHERE t1.BACTIVO = 1 AND t1.BBAJA = 0 AND (t1.DSALDO <> t2.DSALDO)
) src
ON (dest.UIDMONEDERO = src.UIDMONEDERO)
WHEN MATCHED THEN
UPDATE
SET dest.DSALDO = src.DSALDO;

SELECT 'MONEDEROS diferencia en campo DSALDO (MONEDEROCONSULTAS vs APPMONEDEROQUERY)' AS fuente,
COUNT(0) AS discrepancias
FROM MONEDEROCONSULTAS.ESTADODECUENTA t1
INNER JOIN APPMONEDEROQUERY.ESTADODECUENTA t2 ON t1.UIDMONEDERO = t2.UIDMONEDERO
WHERE t1.BACTIVO = 1 AND t1.BBAJA = 0 AND (t1.DSALDO <> t2.DSALDO);