
--REVISISIÓN SALDO ENTRE REPLICAS
SELECT 
U4.INUMMONEDERO ,
U1.DSALDO AS MONEDERO_CONSULTAS,
m2.DSALDO  AS MONEDERO_COMERCIOS,
U3.DSALDO AS MONEDERO_APPTICKETS,
U4.DSALDO  AS MQUERY_APP_SALDO,
U5.DSALDO  AS MCOMANDOS_APP_SALDO,
u6.DSALDO  AS PAGOS,
U2.DSALDO AS APP,
U3.UIDESTATUS AS UIESTATUSCUENTA_MONEDERO,
U1.UIDMONEDERO ,
U1.UIDESTADODECUENTA,
U3.SESTATUS,
U2.SESTATUS  FROM 
PREP_MONEDEROCONSULTAS.ESTADODECUENTA U1 
LEFT JOIN  PREP_APP.ESTADODECUENTA U2 ON U2.UIDESTADODECUENTA =U1.UIDESTADODECUENTA
LEFT JOIN PREP_APPTICKETS.ESTADODECUENTA U3 ON U3.UIDMONEDERO =U1.UIDMONEDERO  AND U3.BBAJA=0 AND U3.BACTIVO =1
LEFT JOIN PREP_APPMONEDEROQUERY.ESTADODECUENTA U4 ON U4.UIDESTADODECUENTA =U1.UIDESTADODECUENTA
LEFT JOIN PREP_APPMONEDEROCOMMAND.ESTADODECUENTA U5 ON U5.UIDESTADODECUENTA =U1.UIDESTADODECUENTA
LEFT JOIN PREP_PAGOS.ESTADODECUENTA U6 ON U6.UIDESTADODECUENTA =U1.UIDESTADODECUENTA
LEFT JOIN PREP_COMERCIO.MONEDEROSTARJETAS m2  ON M2.UIDMONEDERO =U1.UIDMONEDERO 
WHERE U1.UIDMONEDERO IN (
'd8189f7d-84cf-49de-98bf-bb5ff4e133d3','9aee5341-b322-4737-8459-c1ab6623f3e9','23afa2e7-8ee7-458e-9383-928bee7b0349',
'cdb7b93e-60ce-4c80-a8a7-451fb1b2a55d','dbaec43e-c98a-4547-a217-f665a866e19c','f0024a8f-0f42-4f96-891e-c325123ee9f1',
'a1c1fefe-b397-46e2-9e86-e2386181a64d','2a409da5-4915-404a-bf49-cf5e4a9e8977','5a5acc58-39d5-4e04-98fa-78e139d73774',
'48905fee-77f8-41cc-94c4-4a3f3bdd83e5'
)
ORDER  BY U1.DTFECHAULTIMAOPERACION DESC;

--REVISION DE CANTIDAD DE MOVIMIENTOS
SELECT
  (SELECT COUNT(*) FROM PREP_MONEDEROCONSULTAS.MOVIMIENTOS) AS MOVIMIENTOS_ESTADOS,
  (SELECT COUNT(*) FROM PREP_APPMONEDEROQUERY.MOVIMIENTOSOPERACIONES) AS MOVIMIENTOS_APPMONQ
FROM dual;

WITH movimientos_filtrados AS (
  SELECT uidmonedero, uidoperacion
  FROM PREP_MONEDEROCOMANDOS.MOVIMIENTOSESTADOSDECUENTA
  WHERE uidmonedero = 
  'd8189f7d-84cf-49de-98bf-bb5ff4e133d3'
  --'9aee5341-b322-4737-8459-c1ab6623f3e9'
  --'23afa2e7-8ee7-458e-9383-928bee7b0349'
  --'cdb7b93e-60ce-4c80-a8a7-451fb1b2a55d'
  --'dbaec43e-c98a-4547-a217-f665a866e19c'
  --'f0024a8f-0f42-4f96-891e-c325123ee9f1'
  --'a1c1fefe-b397-46e2-9e86-e2386181a64d'
  --'2a409da5-4915-404a-bf49-cf5e4a9e8977'
  --'5a5acc58-39d5-4e04-98fa-78e139d73774',
  --'48905fee-77f8-41cc-94c4-4a3f3bdd83e5'
  AND DTFECHACREACION > TO_DATE('07-08-2025 11:00:00', 'DD-MM-YYYY HH24:MI:SS')
)
SELECT
  (SELECT COUNT(1) FROM movimientos_filtrados) AS total_pivote,
  (SELECT COUNT(1) FROM PREP_APPMONEDEROQUERY.MOVIMIENTOSOPERACIONES r1
    --LEFT --VERIFICAR FALTANTES PARA REPLICAR
    JOIN movimientos_filtrados mf ON r1.uidoperacion = mf.uidoperacion 
    --WHERE r1.uidoperacion IS NULL --VERIFICAR FALTANTES PARA REPLICAR
    --AND r1.uidmonedero = mf.uidmonedero --VERIFICAR FALTANTES PARA REPLICAR
    ) AS total_en_appmonq,
  (SELECT COUNT(1) FROM PREP_MONEDEROCONSULTAS.MOVIMIENTOS r2
    --LEFT --VERIFICAR FALTANTES PARA REPLICAR
    JOIN movimientos_filtrados mf ON r2.uidoperacion = mf.uidoperacion 
    --WHERE r2.uidoperacion IS NULL --VERIFICAR FALTANTES PARA REPLICAR
    --AND r2.uidmonedero = mf.uidmonedero --VERIFICAR FALTANTES PARA REPLICAR
    ) AS total_en_monq
FROM dual;

--REVISISIÓN ESTATUS ENTRE REPLICAS
SELECT 
U4.INUMMONEDERO ,
U1.UIDESTATUS AS MONEDERO_CONSULTAS,
m2.UIDESTATUS  AS MONEDERO_COMERCIOS,
U3.UIDESTATUS AS MONEDERO_APPTICKETS,
U4.UIDESTATUSMONEDERO  AS MQUERY_APP_SALDO,
U5.UIDESTATUSMONEDERO  AS MCOMANDOS_APP_SALDO,
u6.UIDESTATUS  AS PAGOS,
U2.SESTATUS AS APP,
U3.UIDESTATUS AS UIESTATUSCUENTA_MONEDERO
FROM 
PREP_MONEDEROCONSULTAS.ESTADODECUENTA U1 
LEFT JOIN PREP_APP.ESTADODECUENTA U2 ON U2.UIDESTADODECUENTA =U1.UIDESTADODECUENTA
LEFT JOIN PREP_APPTICKETS.ESTADODECUENTA U3 ON U3.UIDMONEDERO =U1.UIDMONEDERO  AND U3.BBAJA=0 AND U3.BACTIVO =1
LEFT JOIN PREP_APPMONEDEROQUERY.ESTADODECUENTA U4 ON U4.UIDESTADODECUENTA =U1.UIDESTADODECUENTA
LEFT JOIN PREP_APPMONEDEROCOMMAND.ESTADODECUENTA U5 ON U5.UIDESTADODECUENTA =U1.UIDESTADODECUENTA
LEFT JOIN PREP_PAGOS.ESTADODECUENTA U6 ON U6.UIDESTADODECUENTA =U1.UIDESTADODECUENTA
LEFT JOIN PREP_COMERCIO.MONEDEROSTARJETAS m2  ON M2.UIDMONEDERO =U1.UIDMONEDERO 
WHERE U1.UIDMONEDERO IN (
'd8189f7d-84cf-49de-98bf-bb5ff4e133d3','9aee5341-b322-4737-8459-c1ab6623f3e9','23afa2e7-8ee7-458e-9383-928bee7b0349',
'cdb7b93e-60ce-4c80-a8a7-451fb1b2a55d','dbaec43e-c98a-4547-a217-f665a866e19c','f0024a8f-0f42-4f96-891e-c325123ee9f1',
'a1c1fefe-b397-46e2-9e86-e2386181a64d','2a409da5-4915-404a-bf49-cf5e4a9e8977','5a5acc58-39d5-4e04-98fa-78e139d73774',
'48905fee-77f8-41cc-94c4-4a3f3bdd83e5'
)
ORDER  BY U1.DTFECHAULTIMAOPERACION DESC;

--CANCELACIONES
SELECT COUNT(1) FROM PREP_MONEDEROCOMANDOS.movimientosestadosdecuenta
WHERE bcancelado = 1 AND UIDOPERACION IN
(
'',
''
)

SELECT COUNT(1) FROM PREP_MONEDEROCONSULTAS.MOVIMIENTOS
WHERE bcancelacion = 1 AND UIDOPERACION IN
(
'',
''
)

---MONEDERO CONSULTAS

--MOTIVOS
SELECT *
FROM PREP_CATALOGOS.MOTIVOS P
WHERE UIDMOTIVO NOT IN (
    SELECT UIDMOTIVO
    FROM PREP_MONEDEROCONSULTAS.MOTIVOS
) AND P.BACTIVO = 1 AND P.IMODULO = 200;

Select * from PREP_MONEDEROCONSULTAS.MOTIVOS 
WHERE SNOMBRE = '';
  
---MONEDERO COMANDOS

--PAQUETES

SELECT *
FROM PREP_CATALOGOS.PAQUETES P
INNER JOIN PREP_CATALOGOS.PRODUCTOS P1 ON P.UIDPRODUCTO = P1.UIDPRODUCTO
WHERE UIDPAQUETE NOT IN (
    SELECT UIDPAQUETE
    FROM PREP_MONEDEROCOMANDOS.PAQUETES
) AND P.BACTIVO = 1 AND P1.BAPP = 1;

Select * from PREP_MONEDEROCOMANDOS.PAQUETES 
WHERE SNOMBRE = '';

--PAQUETECOMISIONES
SELECT *
FROM PREP_CATALOGOS.COMISIONESPAQUETESMON P
WHERE UIDCOMISIONESPAQUETEMON NOT IN (
    SELECT UIDPAQUETECOMISIONES
    FROM PREP_MONEDEROCOMANDOS.PAQUETECOMISIONES
) AND P.BACTIVO = 1;

Select * from PREP_MONEDEROCOMANDOS.PAQUETECOMISIONES 
WHERE UIDPAQUETE = '';

--PRODUCTOS

SELECT *
FROM PREP_CATALOGOS.PRODUCTOS P
WHERE UIDPRODUCTO NOT IN (
    SELECT UIDPRODUCTO
    FROM PREP_MONEDEROCOMANDOS.PRODUCTOS
)AND P.BAPP = 1 AND P.BACTIVO = 1;

Select * from PREP_MONEDEROCOMANDOS.PRODUCTOS 
WHERE SNOMBRE = '';

--COMISIONESPRODUCTO
SELECT *
FROM PREP_CATALOGOS.COMISIONESPRODUCTOSMON P
WHERE UIDCOMISIONESPRODUCTOMON NOT IN (
    SELECT UIDCOMISIONESPRODUCTO
    FROM PREP_MONEDEROCOMANDOS.COMISIONESPRODUCTO
) AND P.BACTIVO = 1;

Select * from PREP_MONEDEROCOMANDOS.COMISIONESPRODUCTO 
WHERE UIDPRODUCTO = '';

--CONFIGURACIONGENERAL
SELECT *
FROM PREP_CATALOGOS.CONFIGURACIONMODULOS P
WHERE UIDCONFIGURACIONMODULO NOT IN (
    SELECT UIDCONFIGURACIONGENERAL
    FROM PREP_MONEDEROCOMANDOS.CONFIGURACIONGENERAL
) AND P.BACTIVO = 1 AND P.IMODULO = 200;

Select * from PREP_MONEDEROCOMANDOS.CONFIGURACIONGENERAL
WHERE SNOMBRE = '';

---ESTATUS MONEDERO

--MOTIVOS
SELECT *
FROM PREP_CATALOGOS.MOTIVOS P
WHERE UIDMOTIVO NOT IN (
    SELECT UIDMOTIVO
    FROM PREP_ESTATUSMONEDERO.MOTIVO
) AND P.BACTIVO = 1 AND P.IMODULO = 200;

Select * from PREP_ESTATUSMONEDERO.MOTIVO
WHERE SNOMBRE = '';

--CONFIGURACIONGENERAL
SELECT *
FROM PREP_CATALOGOS.CONFIGURACIONMODULOS P
WHERE UIDCONFIGURACIONMODULO NOT IN (
    SELECT UIDCONFIGURACIONGENERAL
    FROM PREP_ESTATUSMONEDERO.CONFIGURACIONGENERAL
) AND P.BACTIVO = 1 AND P.IMODULO = 2000;

Select * from PREP_ESTATUSMONEDERO.CONFIGURACIONGENERAL
WHERE SNOMBRE = '';
