


MERGE INTO APPMONEDEROCOMMAND.ESTADODECUENTA REPLICA
USING (
SELECT t1.uidmonedero,T2.BACTIVO,T2.BBAJA,t2.sccv,t2.dtfechavalidez 
--,T1.* 
FROM APPMONEDEROCOMMAND.ESTADODECUENTA T1
INNER JOIN CREDENCIALIZACION.TARJETAS T2 ON T1.UIDMONEDERO = T2.UIDMONEDERO
INNER JOIN MONEDEROCOMANDOS.MONEDERO T3 ON T2.UIDMONEDERO = T3.uidmonedero
WHERE 
1=1
AND T1.INUMEROTARJETA = '5000000001081919' 
AND T1.BACTIVOTARJETA IS NULL 
AND T3.UIDTIPOSMONEDERO='e7f21096-73e4-4fe9-aed6-ee29947304b0'
AND t2.dtfechavalidez IS NOT NULL
) ORIGEN
  ON (ORIGEN.UIDMONEDERO = REPLICA.UIDMONEDERO)
WHEN MATCHED THEN
  UPDATE SET  
  REPLICA.BACTIVOTARJETA= ORIGEN.BACTIVO
  ,REPLICA.BBAJATARJETA = ORIGEN.BBAJA
  ,REPLICA.SCCV = ORIGEN.SCCV
  ,REPLICA.DTFECHAVALIDEZ = ORIGEN.dtfechavalidez
;

MERGE INTO APPMONEDEROQUERY.ESTADODECUENTA REPLICA
USING (
SELECT t1.uidmonedero,T2.BACTIVO,T2.BBAJA,t2.sccv,t2.dtfechavalidez 
--,T1.* 
FROM APPMONEDEROQUERY.ESTADODECUENTA T1
INNER JOIN CREDENCIALIZACION.TARJETAS T2 ON T1.UIDMONEDERO = T2.UIDMONEDERO
INNER JOIN MONEDEROCOMANDOS.MONEDERO T3 ON T2.UIDMONEDERO = T3.uidmonedero
WHERE 
1=1
AND T1.INUMEROTARJETA = '5000000001081919' 
AND T1.BACTIVOTARJETA IS NULL 
AND T3.UIDTIPOSMONEDERO='e7f21096-73e4-4fe9-aed6-ee29947304b0'
AND t2.dtfechavalidez IS NOT NULL
) ORIGEN
  ON (ORIGEN.UIDMONEDERO = REPLICA.UIDMONEDERO)
WHEN MATCHED THEN
  UPDATE SET  
  REPLICA.BACTIVOTARJETA= ORIGEN.BACTIVO
  ,REPLICA.BBAJATARJETA = ORIGEN.BBAJA;
-- COMMIT;