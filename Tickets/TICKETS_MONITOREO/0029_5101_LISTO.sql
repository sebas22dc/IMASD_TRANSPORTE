-- -- Eliminar las cuentas con correos mariabarrancos@gmai.com
-- --     mariabalam110@gmail.com
-- para quedarse solo con el correo luisabalam110@gmail.com
--
--
--
-- -- Se validan las cuentas y no tienen saldo, se anexa la relacion cuenta / monedero
-- --mariabalam110@gmail.com con monedero 1000000001505507
-- --mariabarrancos@gmai.com con monedero 1000000001167269
-- --luisabalam110@gmail.com con monedero 1000000001025907
--
-- 1000000001505507
-- 1000000001167269
--

--se eliminaran dados de baja estos dos correos

select * from app.usuario where scorreo = 'mariabarrancos@gmai.com';
select * from app.usuario where scorreo = 'mariabalam110@gmail.com';

-------- PRIMER CUENTA A DAR DE BAJA


SELECT * FROM APP.USUARIO                         WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';
SELECT * FROM APPMONEDEROCOMMAND.USUARIO          WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';
SELECT * FROM APPTICKETS.USUARIO                  WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';
SELECT * FROM PAGOS.USUARIO                       WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';

---UPDATES
UPDATE APP.USUARIO SET BACTIVO=0,BBAJA=1                         WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';COMMIT;
UPDATE APPMONEDEROCOMMAND.USUARIO SET BACTIVO=0,BBAJA=1          WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';COMMIT;
UPDATE APPTICKETS.USUARIO SET BACTIVO=0,BBAJA=1                  WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';COMMIT;
UPDATE PAGOS.USUARIO SET BACTIVO=0,BBAJA=1                       WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';COMMIT;

--SELECTS DE POSTERIOR

SELECT * FROM APP.USUARIO                         WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';
SELECT * FROM APPMONEDEROCOMMAND.USUARIO          WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';
SELECT * FROM APPTICKETS.USUARIO                  WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';
SELECT * FROM PAGOS.USUARIO                       WHERE UIDUSUARIO='80fd225a-a4d0-4a29-a91e-d959931e0af6';



-----------------------------SEGUNDA CUENTA A DAR DE BAJA

SELECT * FROM APP.USUARIO                         WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';
SELECT * FROM APPMONEDEROCOMMAND.USUARIO          WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';
SELECT * FROM APPTICKETS.USUARIO                  WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';
SELECT * FROM PAGOS.USUARIO                       WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';

---UPDATES
UPDATE APP.USUARIO SET BACTIVO=0,BBAJA=1                         WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';COMMIT;
UPDATE APPMONEDEROCOMMAND.USUARIO SET BACTIVO=0,BBAJA=1          WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';COMMIT;
UPDATE APPTICKETS.USUARIO SET BACTIVO=0,BBAJA=1                  WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';COMMIT;
UPDATE PAGOS.USUARIO SET BACTIVO=0,BBAJA=1                       WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';COMMIT;

--SELECTS DE POSTERIOR

SELECT * FROM APP.USUARIO                         WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';
SELECT * FROM APPMONEDEROCOMMAND.USUARIO          WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';
SELECT * FROM APPTICKETS.USUARIO                  WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';
SELECT * FROM PAGOS.USUARIO                       WHERE UIDUSUARIO='04cfa985-bbf3-4acb-bda2-b77d93a21bd2';




----DESVINCULAR LAS TARJETAS DE LA SEGUNDA CUENTA, SOLO ESA CUENTA TIENE TARJETAS ASOCIADAS


--Se actualizan registros dados de baja

UPDATE APPMONEDEROQUERY.TARJETAUSUARIO SET BACTIVO = 0, BBAJA = 1
--SELECT COUNT(0) FROM APPMONEDEROQUERY.TARJETAUSUARIO
WHERE UIDTARJETA IN (
SELECT t.UIDTARJETA
FROM APPMONEDEROQUERY.TARJETAUSUARIO t
INNER JOIN APPMONEDEROQUERY.ESTADODECUENTA e ON t.UIDMONEDERO = e.UIDMONEDERO
INNER JOIN CREDENCIALIZACION.ESTATUSTARJETA et ON et.UIDESTATUSTARJETA = e.UIDESTATUSTARJETA
INNER JOIN APPMONEDEROQUERY.USUARIO u ON t.UIDUSUARIO = u.UIDUSUARIO
INNER JOIN APP.USUARIO usu ON u.UIDUSUARIO = usu.UIDUSUARIO
WHERE 1=1 and (usu.BBAJA = 1 OR usu.BACTIVO = 0)
AND t.BACTIVO = 1 AND usu.UIDUSUARIO = '80fd225a-a4d0-4a29-a91e-d959931e0af6'
);commit;

UPDATE APPMONEDEROCOMMAND.TARJETAUSUARIO SET BACTIVO = 0, BBAJA = 1
--SELECT COUNT(0) FROM APPMONEDEROCOMMAND.TARJETAUSUARIO
WHERE UIDTARJETA IN (
SELECT am.UIDTARJETA
FROM APPMONEDEROCOMMAND.TARJETAUSUARIO AM
INNER JOIN APPMONEDEROCOMMAND.ESTADODECUENTA AE ON AE.UIDMONEDERO = AM.UIDMONEDERO
INNER JOIN APPMONEDEROCOMMAND.USUARIO USU ON USU.UIDUSUARIO = AM.UIDUSUARIO
INNER JOIN APP.USUARIO USU2 ON USU2.UIDUSUARIO = usu.UIDUSUARIO
WHERE
-- am.snumerotarjeta = 5000000000593414
1=1
AND USU2.BBAJA = 1
AND AM.BACTIVO = 1
AND USU2.UIDUSUARIO = '80fd225a-a4d0-4a29-a91e-d959931e0af6' --and am.snumerotarjeta = 5000000000593414
);
commit;