-- 9638
-- "5000000000146728
-- 5000000000146729"
-- "Se valida que la cuenta con correo: keila.andueza@icloud.con y teléfono: 9995302108 contiene las tarjetas vinculadas:
-- –        5000000000146728
-- –        5000000000146729
-- "	"Usuario reporta que no
-- puede ingresar a su app vayven con el correo: keila.andueza@icloud.con ya que no es
--     .COM y no le llega tal contraseña de restablecimiento, pide que se borre esa cuenta
--     y también la de ramosanduezarosalba@gmail.com, quiere borrarla y desvincular las tarjetas
--     para poder poner su correo correctamente, en este caso keila.andueza@icloud.com
-- Tarjetas vinculadas:
-- 5000 0000 0014 6728
-- 5000 0000 0014 6729
--
-- Keila Rosalba Ramos Andueza
--   Keila.andueza@icloud.com
-- 9995302108"	"Desvincular las tarjetas de la cuenta con correo: keila.andueza@icloud.con:
-- –        5000000000146728
-- –        5000000000146729
-- Eliminar las 2 cuentas:
-- –        Correo electrónico: ramosanduezarosalba@gmail.com
-- –        Teléfono: 9995302108
--
-- –        Correo electrónico: keila.andueza@icloud.con
-- –        Teléfono: 9995302108
-- "		Pedro


-- CUENTA 1 BAJA Y DESVINCULACOIN

SELECT * FROM APP.USUARIO                         WHERE UIDUSUARIO='181ebaaf-8a8a-4ad7-9fa6-c58a406adff7';
SELECT * FROM APPMONEDEROCOMMAND.USUARIO          WHERE UIDUSUARIO='181ebaaf-8a8a-4ad7-9fa6-c58a406adff7';
SELECT * FROM APPTICKETS.USUARIO                  WHERE UIDUSUARIO='181ebaaf-8a8a-4ad7-9fa6-c58a406adff7';
SELECT * FROM PAGOS.USUARIO                       WHERE UIDUSUARIO='181ebaaf-8a8a-4ad7-9fa6-c58a406adff7';

---UPDATES
UPDATE APP.USUARIO SET BACTIVO=0,BBAJA=1                         WHERE UIDUSUARIO='181ebaaf-8a8a-4ad7-9fa6-c58a406adff7';COMMIT;
UPDATE APPMONEDEROCOMMAND.USUARIO SET BACTIVO=0,BBAJA=1          WHERE UIDUSUARIO='181ebaaf-8a8a-4ad7-9fa6-c58a406adff7';COMMIT;
UPDATE APPTICKETS.USUARIO SET BACTIVO=0,BBAJA=1                  WHERE UIDUSUARIO='181ebaaf-8a8a-4ad7-9fa6-c58a406adff7';COMMIT;
UPDATE PAGOS.USUARIO SET BACTIVO=0,BBAJA=1                       WHERE UIDUSUARIO='181ebaaf-8a8a-4ad7-9fa6-c58a406adff7';COMMIT;
----DESVINCULAR LAS TARJETAS DE LA SEGUNDA CUENTA, SOLO ESA CUENTA TIENE TARJETAS ASOCIADAS


--Se actualizan registros dados de baja

UPDATE APPMONEDEROQUERY.TARJETAUSUARIO SET BACTIVO = 0, BBAJA = 1
--SELECT COUNT(0) FROM APPMONEDEROQUERY.TARJETAUSUARIO
WHERE UIDTARJETA IN (
SELECT t.UIDTARJETA
FROM APPMONEDEROQUERY.TARJETAUSUARIO t
INNER JOIN APPMONEDEROQUERY.ESTADODECUENTA e ON t.UIDMONEDERO = e.UIDMONEDERO
INNER JOIN CREDENCIALIZACION.ESTATUSTARJETA et ON et.UIDESTATUSTARJETA = e.UIDESTATUSTARJETA
INNER JOIN APPMONEDEROQUERY.USUARIO u ON t.UIDUSUARIO = u.UIDUSUARIO
INNER JOIN APP.USUARIO usu ON u.UIDUSUARIO = usu.UIDUSUARIO
WHERE 1=1 and (usu.BBAJA = 1 OR usu.BACTIVO = 0)
AND t.BACTIVO = 1 AND usu.UIDUSUARIO = '181ebaaf-8a8a-4ad7-9fa6-c58a406adff7'
);commit;

UPDATE APPMONEDEROCOMMAND.TARJETAUSUARIO SET BACTIVO = 0, BBAJA = 1
--SELECT COUNT(0) FROM APPMONEDEROCOMMAND.TARJETAUSUARIO
WHERE UIDTARJETA IN (
SELECT am.UIDTARJETA
FROM APPMONEDEROCOMMAND.TARJETAUSUARIO AM
INNER JOIN APPMONEDEROCOMMAND.ESTADODECUENTA AE ON AE.UIDMONEDERO = AM.UIDMONEDERO
INNER JOIN APPMONEDEROCOMMAND.USUARIO USU ON USU.UIDUSUARIO = AM.UIDUSUARIO
INNER JOIN APP.USUARIO USU2 ON USU2.UIDUSUARIO = usu.UIDUSUARIO
WHERE
-- am.snumerotarjeta = 5000000000593414
1=1
AND USU2.BBAJA = 1
AND AM.BACTIVO = 1
AND USU2.UIDUSUARIO = '181ebaaf-8a8a-4ad7-9fa6-c58a406adff7' --and am.snumerotarjeta = 5000000000593414
);
commit;




---- CUENTA 2 BAJA


SELECT * FROM APP.USUARIO                         WHERE UIDUSUARIO='ff147a7d-2c51-4da2-aa98-7eb15f631368';
SELECT * FROM APPMONEDEROCOMMAND.USUARIO          WHERE UIDUSUARIO='ff147a7d-2c51-4da2-aa98-7eb15f631368';
SELECT * FROM APPTICKETS.USUARIO                  WHERE UIDUSUARIO='ff147a7d-2c51-4da2-aa98-7eb15f631368';
SELECT * FROM PAGOS.USUARIO                       WHERE UIDUSUARIO='ff147a7d-2c51-4da2-aa98-7eb15f631368';

---UPDATES
UPDATE APP.USUARIO SET BACTIVO=0,BBAJA=1                         WHERE UIDUSUARIO='ff147a7d-2c51-4da2-aa98-7eb15f631368';COMMIT;
UPDATE APPMONEDEROCOMMAND.USUARIO SET BACTIVO=0,BBAJA=1          WHERE UIDUSUARIO='ff147a7d-2c51-4da2-aa98-7eb15f631368';COMMIT;
UPDATE APPTICKETS.USUARIO SET BACTIVO=0,BBAJA=1                  WHERE UIDUSUARIO='ff147a7d-2c51-4da2-aa98-7eb15f631368';COMMIT;
UPDATE PAGOS.USUARIO SET BACTIVO=0,BBAJA=1                       WHERE UIDUSUARIO='ff147a7d-2c51-4da2-aa98-7eb15f631368';COMMIT;



